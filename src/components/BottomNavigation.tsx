import { Link, useLocation } from "react-router-dom";
import dayjs from "dayjs";
import { useTheme } from "./theme-provider";

export default function BottomNavigation() {
  const location = useLocation();
  const path = location.pathname.toLowerCase();
  const today = dayjs().format('YYYY-MM-DD');
  const { theme } = useTheme();
  const isDark = theme === "dark" || (theme === "system" && window.matchMedia("(prefers-color-scheme: dark)").matches);

  return (
    <div className="fixed bottom-0 left-0 w-full max-w-md mx-auto z-40" style={{ minWidth: 0 }}>
      <div className="relative w-full" style={{ aspectRatio: "414/84" }}>
        <svg
          viewBox="0 0 393 84"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          className="w-full h-full"
          preserveAspectRatio="none"
        >
          <path
            opacity="0.96"
            d="M197.5 0C207.24 0 215.877 4.72168 221.249 12H369C382.255 12 393 22.7452 393 36V84H0V36C0 22.7452 10.7452 12 24 12H173.751C179.123 4.72168 187.76 0 197.5 0Z"
            fill={isDark ? "#18181C" : "white"}
          />
          <circle opacity="0.9" cx="197.5" cy="29.5" r="24.5" fill={isDark ? "#EAE9EA" : "black"} />
          <path d="M185.49 29.9805H209.51" stroke={isDark? "black":"white" } strokeWidth={3} strokeLinecap="round" />
          <path d="M197.495 41.9951L197.495 17.9755" stroke={isDark? "black":"white" } strokeWidth={3} strokeLinecap="round"/>

          {/* Home 아이콘 (고정 검정색) */}
          <path
            d="M50.8957 48.5048V45.1922C50.8957 44.3466 51.5862 43.6612 52.438 43.6612H55.5517C55.9607 43.6612 56.353 43.8225 56.6422 44.1096C56.9315 44.3967 57.094 44.7862 57.094 45.1922V48.5048C57.0914 48.8563 57.2302 49.1944 57.4797 49.4439C57.7292 49.6933 58.0687 49.8337 58.4229 49.8336H60.5472C61.5393 49.8362 62.4917 49.4467 63.1941 48.7512C63.8966 48.0557 64.2913 47.1112 64.2913 46.1263V36.6894C64.2913 35.8938 63.9361 35.1392 63.3213 34.6287L56.0949 28.8992C54.8378 27.8946 53.0367 27.927 51.8172 28.9762L44.7556 34.6287C44.1118 35.1241 43.727 35.881 43.708 36.6894V46.1167C43.708 48.1695 45.3843 49.8336 47.4522 49.8336H49.528C50.2635 49.8337 50.8613 49.2446 50.8666 48.5144L50.8957 48.5048Z"
            fill={isDark ? (path === "/" ? "white" : "#CFCFD2") : (path === "/" ? "black" : "#B6B6B6")}
          />
          {/* Report 아이콘 */}
          <path
            d="M115.58 40.5923C117.108 40.5923 118.332 41.8284 118.332 43.3667V47.0591C118.332 48.5866 117.108 49.8325 115.58 49.8325H111.919C110.402 49.8325 109.167 48.5866 109.167 47.0591V43.3667C109.167 41.8284 110.402 40.5923 111.919 40.5923H115.58ZM128.082 40.5923C129.599 40.5923 130.834 41.8284 130.834 43.3667V47.0591C130.834 48.5866 129.599 49.8325 128.082 49.8325H124.421C122.893 49.8325 121.669 48.5866 121.669 47.0591V43.3667C121.669 41.8284 122.893 40.5923 124.421 40.5923H128.082ZM115.58 28.1665C117.108 28.1665 118.332 29.4123 118.332 30.9409V34.6343C118.332 36.1725 117.107 37.4077 115.58 37.4077H111.919C110.402 37.4077 109.167 36.1725 109.167 34.6343V30.9409C109.167 29.4123 110.402 28.1665 111.919 28.1665H115.58ZM128.082 28.1665C129.599 28.1665 130.834 29.4123 130.834 30.9409V34.6343C130.834 36.1725 129.599 37.4077 128.082 37.4077H124.421C122.893 37.4077 121.669 36.1725 121.669 34.6343V30.9409C121.669 29.4123 122.893 28.1665 124.421 28.1665H128.082Z"
            fill={isDark ? ((path === "/routine" || path === "/contents") ? "white" : "#CFCFD2") : ((path === "/routine" || path === "/contents") ? "black" : "#B6B6B6")}
          />
          {/* Analysis 아이콘 (새로운 디자인 반영) */}
          <path
            d="M278.024 29.4106C277.978 29.7023 277.955 29.994 277.955 30.2856C277.955 32.9106 280.078 35.0327 282.691 35.0327C282.983 35.0327 283.263 34.9993 283.555 34.9526V44.3657C283.555 48.3218 281.221 50.6674 277.255 50.6675H268.634C264.666 50.6673 262.333 48.3218 262.333 44.3657V35.7339C262.333 31.7673 264.666 29.4108 268.634 29.4106H278.024ZM278.259 36.5034C277.943 36.4686 277.629 36.6092 277.441 36.8657L274.619 40.5171L271.387 37.9741C271.188 37.8225 270.955 37.7632 270.722 37.7876C270.49 37.8226 270.279 37.9496 270.138 38.1362L266.686 42.6284L266.614 42.7339C266.416 43.106 266.51 43.5845 266.859 43.8423C267.023 43.9473 267.198 44.0171 267.396 44.0171C267.666 44.0287 267.922 43.8879 268.085 43.6675L271.013 39.8979L274.338 42.396L274.443 42.4644C274.817 42.6625 275.283 42.5703 275.552 42.2192L278.923 37.8687L278.876 37.8921C279.063 37.6354 279.098 37.3088 278.97 37.0171C278.843 36.7255 278.561 36.5267 278.259 36.5034ZM282.854 27.3335C284.406 27.3335 285.666 28.5934 285.666 30.145C285.666 31.6967 284.406 32.9565 282.854 32.9565C281.303 32.9564 280.043 31.6966 280.043 30.145C280.043 28.5935 281.303 27.3337 282.854 27.3335Z"
            fill={isDark ? (path === "/analysis" ? "white" : "#CFCFD2") : (path === "/analysis" ? "black" : "#B6B6B6")}
          />
          {/* 캘린더 아이콘 복원 */}
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M327.333 39.0002C327.333 32.5602 332.548 27.3335 339 27.3335C345.44 27.3335 350.666 32.5602 350.666 39.0002C350.666 45.4518 345.44 50.6668 339 50.6668C332.548 50.6668 327.333 45.4518 327.333 39.0002ZM341.601 41.1352L343.491 35.1618C343.62 34.7535 343.246 34.3685 342.838 34.4968L336.865 36.3635C336.62 36.4452 336.421 36.6318 336.351 36.8768L334.485 42.8618C334.356 43.2585 334.741 43.6435 335.138 43.5152L341.088 41.6485C341.333 41.5785 341.531 41.3802 341.601 41.1352Z"
            fill={isDark ? (path === "/calendar" ? "white" : "#CFCFD2") : (path === "/calendar" ? "black" : "#B6B6B6")}
          />
        </svg>
        {/* 클릭 영역 */}
        <div className="absolute inset-0 flex justify-between items-end pb-4 px-2">
          <Link to="/" className="flex-1 h-full" />
          <Link to="/routine" className="flex-1 h-full" />
          <Link to={`/diary/${today}`} className="flex-1 h-full flex justify-center items-end">
            <div className="w-14 h-14 -mt-4 z-10 rounded-full" />
          </Link>
          <Link to="/analysis" className="flex-1 h-full" />
          <Link to="/calendar" className="flex-1 h-full" />
        </div>
      </div>
    </div>
  );
}
